{% extends "base.html" %}


{% block title %}View order #{{ order.pk }}{% endblock %}

{% block head %}
    {% load dajaxice_templatetags %}
    {% dajaxice_js_import %}
    <script src="{{ STATIC_URL }}js/orders/detail.js" type="text/javascript" charset="utf-8"></script>
{% endblock %}

{% block content %}

<div id='error'></div>

Order #{{ order.pk }}<br />
Property: <a href="{% url places_detail pk=order.place.pk %}">{{ order.place.name }}</a><br />
Work type: {{ order.get_work_type_display }}<br />
Created by <a href="{% url users_detail pk=order.creator.pk %}">{{ order.creator.get_full_name }}</a><br />
Created on {{ order.created }}<br />
Approver:
    {% if order.approver %}
        <a href="{% url users_detail pk=order.approver.pk %}">{{ order.approver.get_full_name }}</a><br />
    {% else %}
        No approver assigned yet.<br />
    {% endif %}
Status: {{ order.get_status_display|capfirst }}<br />
Vendor:
    {% if order.vendor %}
        <a href="{% url vendors_detail pk=order.vendor.pk %}">{{ order.vendor.name }}</a>
    {% else %}
        Not assigned yet.
    {% endif %}<br />
Quote:
    {% if order.quote %}
        ${{ order.quote }}
    {% else %}
        No quote yet.
    {% endif %}<br />
Payment:
    {% if order.payment %}
        ${{ order.payment }}
    {% else %}
        Not paid yet.
    {% endif %}<br />
<br/>
Comment:<br />
<br />
{{ order.comment|default:"No comment." }}<br />
<br />
Steps:
<table>
    {% if order.all_steps %}
        {% for step in order.all_steps %}
            <tr>
                <td>
                    <input type="checkbox"
                        id="step_{{ forloop.counter }}"
                        onclick="Dajaxice.doors.step_changed(update_steps, {
                            'order_pk': {{ order.pk }},
                            'local_timezone': '{{ request.user.profile.get_local_timezone_display }}',
                            'step_pk': {{ forloop.counter }},
                            'checked': this.checked
                        })"
                    {% if step.0 %}
                        checked="yes"
                    {% endif %}
                    {% if forloop.counter in order.disabled_steps or not can_edit %}
                        disabled
                    {% endif %}
                    />
                </td>
                <td><div id="step_{{ forloop.counter }}_datetime">{{ step.0 }}</div></td>
                <td>{{ forloop.counter }}: {{ step.1 }}</td>
            </tr>
        {% endfor %}
    {% else %}
        <tr><td colspan="3">There are no steps? Please report this bug.</td></tr>
    {% endif %}
</table>

Comments ({{ order.comment_count }}):<br />
{% load comments %}

{% render_comment_list for order %}
{% render_comment_form for order %}

{% endblock %}
